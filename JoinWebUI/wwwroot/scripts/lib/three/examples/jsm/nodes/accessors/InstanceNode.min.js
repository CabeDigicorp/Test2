/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/three@0.160.1/examples/jsm/nodes/accessors/InstanceNode.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Node,{addNodeClass}from"../core/Node.js";import{instancedBufferAttribute,instancedDynamicBufferAttribute}from"./BufferAttributeNode.js";import{normalLocal}from"./NormalNode.js";import{positionLocal}from"./PositionNode.js";import{nodeProxy,vec3,mat3,mat4}from"../shadernode/ShaderNode.js";import{DynamicDrawUsage,InstancedInterleavedBuffer}from"three";class InstanceNode extends Node{constructor(e){super("void"),this.instanceMesh=e,this.instanceMatrixNode=null}setup(){let e=this.instanceMatrixNode;if(null===e){const t=this.instanceMesh.instanceMatrix,o=new InstancedInterleavedBuffer(t.array,16,1),n=t.usage===DynamicDrawUsage?instancedDynamicBufferAttribute:instancedBufferAttribute,a=[n(o,"vec4",16,0),n(o,"vec4",16,4),n(o,"vec4",16,8),n(o,"vec4",16,12)];e=mat4(...a),this.instanceMatrixNode=e}const t=e.mul(positionLocal).xyz,o=mat3(e[0].xyz,e[1].xyz,e[2].xyz),n=normalLocal.div(vec3(o[0].dot(o[0]),o[1].dot(o[1]),o[2].dot(o[2]))),a=o.mul(n).xyz;positionLocal.assign(t),normalLocal.assign(a)}}export default InstanceNode;export const instance=nodeProxy(InstanceNode);addNodeClass("InstanceNode",InstanceNode);
//# sourceMappingURL=/sm/e7113dc6b33d3893c4058845cac3b8e5c01976bef944441f85ce06f0549f34c0.map