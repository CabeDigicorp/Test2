/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/three@0.160.1/examples/jsm/nodes/display/NormalMapNode.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import TempNode from"../core/TempNode.js";import{add}from"../math/OperatorNode.js";import{bitangentView}from"../accessors/BitangentNode.js";import{modelNormalMatrix}from"../accessors/ModelNode.js";import{normalView}from"../accessors/NormalNode.js";import{positionView}from"../accessors/PositionNode.js";import{tangentView}from"../accessors/TangentNode.js";import{uv}from"../accessors/UVNode.js";import{faceDirection}from"./FrontFacingNode.js";import{addNodeClass}from"../core/Node.js";import{addNodeElement,tslFn,nodeProxy,vec3,mat3}from"../shadernode/ShaderNode.js";import{TangentSpaceNormalMap,ObjectSpaceNormalMap}from"three";const perturbNormal2Arb=tslFn((o=>{const{eye_pos:e,surf_norm:r,mapN:a,uv:t}=o,m=e.dFdx(),s=e.dFdy(),d=t.dFdx(),n=t.dFdy(),l=r,i=s.cross(l),p=l.cross(m),N=i.mul(d.x).add(p.mul(n.x)),c=i.mul(d.y).add(p.mul(n.y)),u=N.dot(N).max(c.dot(c)),M=faceDirection.mul(u.inverseSqrt());return add(N.mul(a.x,M),c.mul(a.y,M),l.mul(a.z)).normalize()}));class NormalMapNode extends TempNode{constructor(o,e=null){super("vec3"),this.node=o,this.scaleNode=e,this.normalMapType=TangentSpaceNormalMap}setup(o){const{normalMapType:e,scaleNode:r}=this;let a=this.node.mul(2).sub(1);null!==r&&(a=vec3(a.xy.mul(r),a.z));let t=null;if(e===ObjectSpaceNormalMap)t=modelNormalMatrix.mul(a).normalize();else if(e===TangentSpaceNormalMap){t=!0===o.hasGeometryAttribute("tangent")?TBNViewMatrix.mul(a).normalize():perturbNormal2Arb({eye_pos:positionView,surf_norm:normalView,mapN:a,uv:uv()})}return t}}export default NormalMapNode;export const normalMap=nodeProxy(NormalMapNode);export const TBNViewMatrix=mat3(tangentView,bitangentView,normalView);addNodeElement("normalMap",normalMap),addNodeClass("NormalMapNode",NormalMapNode);
//# sourceMappingURL=/sm/5b8cf277c4ace2c072b33d423d09ee7231e945c6b6425c79a28af9dfb889e946.map