/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/three@0.160.1/examples/jsm/renderers/common/Background.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import DataMap from"./DataMap.js";import Color4 from"./Color4.js";import{Mesh,SphereGeometry,BackSide}from"three";import{vec4,context,normalWorld,backgroundBlurriness,backgroundIntensity,NodeMaterial,modelViewProjection}from"../../nodes/Nodes.js";const _clearColor=new Color4;class Background extends DataMap{constructor(e,r){super(),this.renderer=e,this.nodes=r}update(e,r,o){const l=this.renderer,a=this.nodes.getBackgroundNode(e)||e.background;let t=!1;if(null===a)l._clearColor.getRGB(_clearColor,this.renderer.currentColorSpace),_clearColor.a=l._clearColor.a;else if(!0===a.isColor)a.getRGB(_clearColor,this.renderer.currentColorSpace),_clearColor.a=1,t=!0;else if(!0===a.isNode){const o=this.get(e),t=a;_clearColor.copy(l._clearColor);let c=o.backgroundMesh;if(void 0===c){const e=context(vec4(t),{getUV:()=>normalWorld,getTextureLevel:()=>backgroundBlurriness}).mul(backgroundIntensity);let r=modelViewProjection();r=r.setZ(r.w);const l=new NodeMaterial;l.side=BackSide,l.depthTest=!1,l.depthWrite=!1,l.fog=!1,l.vertexNode=r,l.fragmentNode=e,o.backgroundMeshNode=e,o.backgroundMesh=c=new Mesh(new SphereGeometry(1,32,32),l),c.frustumCulled=!1,c.onBeforeRender=function(e,r,o){this.matrixWorld.copyPosition(o.matrixWorld)}}const n=t.getCacheKey();o.backgroundCacheKey!==n&&(o.backgroundMeshNode.node=vec4(t),c.material.needsUpdate=!0,o.backgroundCacheKey=n),r.unshift(c,c.geometry,c.material,0,0,null)}else console.error("THREE.Renderer: Unsupported background configuration.",a);if(!0===l.autoClear||!0===t){_clearColor.multiplyScalar(_clearColor.a);const e=o.clearColorValue;e.r=_clearColor.r,e.g=_clearColor.g,e.b=_clearColor.b,e.a=_clearColor.a,o.depthClearValue=l._clearDepth,o.stencilClearValue=l._clearStencil,o.clearColor=!0===l.autoClearColor,o.clearDepth=!0===l.autoClearDepth,o.clearStencil=!0===l.autoClearStencil}else o.clearColor=!1,o.clearDepth=!1,o.clearStencil=!1}}export default Background;
//# sourceMappingURL=/sm/01dfba2b4944b0b755d010ec33a11090e006425faf5a4f708c18b0819ba9bd62.map