/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/three@0.170.0/src/nodes/display/NormalMapNode.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import TempNode from"../core/TempNode.js";import{add}from"../math/OperatorNode.js";import{normalView,transformNormalToView}from"../accessors/Normal.js";import{positionView}from"../accessors/Position.js";import{TBNViewMatrix}from"../accessors/AccessorsUtils.js";import{uv}from"../accessors/UV.js";import{faceDirection}from"./FrontFacingNode.js";import{Fn,nodeProxy,vec3}from"../tsl/TSLBase.js";import{TangentSpaceNormalMap,ObjectSpaceNormalMap}from"../../constants.js";const perturbNormal2Arb=Fn((o=>{const{eye_pos:e,surf_norm:r,mapN:a,uv:t}=o,s=e.dFdx(),m=e.dFdy(),l=t.dFdx(),n=t.dFdy(),p=r,i=m.cross(p),c=p.cross(s),d=i.mul(l.x).add(c.mul(n.x)),u=i.mul(l.y).add(c.mul(n.y)),N=d.dot(d).max(u.dot(u)),f=faceDirection.mul(N.inverseSqrt());return add(d.mul(a.x,f),u.mul(a.y,f),p.mul(a.z)).normalize()}));class NormalMapNode extends TempNode{static get type(){return"NormalMapNode"}constructor(o,e=null){super("vec3"),this.node=o,this.scaleNode=e,this.normalMapType=TangentSpaceNormalMap}setup(o){const{normalMapType:e,scaleNode:r}=this;let a=this.node.mul(2).sub(1);null!==r&&(a=vec3(a.xy.mul(r),a.z));let t=null;if(e===ObjectSpaceNormalMap)t=transformNormalToView(a);else if(e===TangentSpaceNormalMap){t=!0===o.hasGeometryAttribute("tangent")?TBNViewMatrix.mul(a).normalize():perturbNormal2Arb({eye_pos:positionView,surf_norm:normalView,mapN:a,uv:uv()})}return t}}export default NormalMapNode;export const normalMap=nodeProxy(NormalMapNode);
//# sourceMappingURL=/sm/28967f74fffcdf682e29b77f94d266856f5016e0c8002191d40d264c6af585d4.map