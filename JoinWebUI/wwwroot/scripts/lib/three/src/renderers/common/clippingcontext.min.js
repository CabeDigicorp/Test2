/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/three@0.170.0/src/renderers/common/ClippingContext.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Matrix3}from"../../math/Matrix3.js";import{Plane}from"../../math/Plane.js";import{Vector4}from"../../math/Vector4.js";import{hash}from"../../nodes/core/NodeUtils.js";const _plane=new Plane;class ClippingContext{constructor(){this.version=0,this.globalClippingCount=0,this.localClippingCount=0,this.localClippingEnabled=!1,this.localClipIntersection=!1,this.planes=[],this.parentVersion=0,this.viewNormalMatrix=new Matrix3,this.cacheKey=0}projectPlanes(i,l){const t=i.length,n=this.planes;for(let e=0;e<t;e++){_plane.copy(i[e]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const t=n[l+e],a=_plane.normal;t.x=-a.x,t.y=-a.y,t.z=-a.z,t.w=_plane.constant}}updateGlobal(i,l){const t=i.clippingPlanes;this.viewMatrix=l.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix);let n=!1;if(Array.isArray(t)&&0!==t.length){const i=t.length;if(i!==this.globalClippingCount){const l=[];for(let t=0;t<i;t++)l.push(new Vector4);this.globalClippingCount=i,this.planes=l,n=!0}this.projectPlanes(t,0)}else 0!==this.globalClippingCount&&(this.globalClippingCount=0,this.planes=[],n=!0);i.localClippingEnabled!==this.localClippingEnabled&&(this.localClippingEnabled=i.localClippingEnabled,n=!0),n&&(this.version++,this.cacheKey=hash(this.globalClippingCount,!0===this.localClippingEnabled?1:0))}update(i,l){let t=!1;if(this!==i&&i.version!==this.parentVersion&&(this.globalClippingCount=l.isShadowNodeMaterial?0:i.globalClippingCount,this.localClippingEnabled=i.localClippingEnabled,this.planes=Array.from(i.planes),this.parentVersion=i.version,this.viewMatrix=i.viewMatrix,this.viewNormalMatrix=i.viewNormalMatrix,t=!0),this.localClippingEnabled){const i=l.clippingPlanes;if(Array.isArray(i)&&0!==i.length){const l=i.length,n=this.planes,e=this.globalClippingCount;if(t||l!==this.localClippingCount){n.length=e+l;for(let i=0;i<l;i++)n[e+i]=new Vector4;this.localClippingCount=l,t=!0}this.projectPlanes(i,e)}else 0!==this.localClippingCount&&(this.localClippingCount=0,t=!0);this.localClipIntersection!==l.clipIntersection&&(this.localClipIntersection=l.clipIntersection,t=!0)}t&&(this.version+=i.version,this.cacheKey=hash(i.cacheKey,this.localClippingCount,!0===this.localClipIntersection?1:0))}}export default ClippingContext;
//# sourceMappingURL=/sm/58795b7546fa29311459f4567a11ceefe6fd293f01707feefa94f6bc95c212b4.map