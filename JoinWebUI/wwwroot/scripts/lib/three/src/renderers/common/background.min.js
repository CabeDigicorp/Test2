/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/three@0.170.0/src/renderers/common/Background.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import DataMap from"./DataMap.js";import Color4 from"./Color4.js";import{vec4,context,normalWorld,backgroundBlurriness,backgroundIntensity,backgroundRotation,modelViewProjection}from"../../nodes/TSL.js";import NodeMaterial from"../../materials/nodes/NodeMaterial.js";import{Mesh}from"../../objects/Mesh.js";import{SphereGeometry}from"../../geometries/SphereGeometry.js";import{BackSide,LinearSRGBColorSpace}from"../../constants.js";const _clearColor=new Color4;class Background extends DataMap{constructor(e,o){super(),this.renderer=e,this.nodes=o}update(e,o,r){const a=this.renderer,t=this.nodes.getBackgroundNode(e)||e.background;let l=!1;if(null===t)a._clearColor.getRGB(_clearColor,LinearSRGBColorSpace),_clearColor.a=a._clearColor.a;else if(!0===t.isColor)t.getRGB(_clearColor,LinearSRGBColorSpace),_clearColor.a=1,l=!0;else if(!0===t.isNode){const r=this.get(e),l=t;_clearColor.copy(a._clearColor);let n=r.backgroundMesh;if(void 0===n){const e=context(vec4(l).mul(backgroundIntensity),{getUV:()=>backgroundRotation.mul(normalWorld),getTextureLevel:()=>backgroundBlurriness});let o=modelViewProjection();o=o.setZ(o.w);const a=new NodeMaterial;a.name="Background.material",a.side=BackSide,a.depthTest=!1,a.depthWrite=!1,a.fog=!1,a.lights=!1,a.vertexNode=o,a.colorNode=e,r.backgroundMeshNode=e,r.backgroundMesh=n=new Mesh(new SphereGeometry(1,32,32),a),n.frustumCulled=!1,n.name="Background.mesh",n.onBeforeRender=function(e,o,r){this.matrixWorld.copyPosition(r.matrixWorld)}}const c=l.getCacheKey();r.backgroundCacheKey!==c&&(r.backgroundMeshNode.node=vec4(l).mul(backgroundIntensity),r.backgroundMeshNode.needsUpdate=!0,n.material.needsUpdate=!0,r.backgroundCacheKey=c),o.unshift(n,n.geometry,n.material,0,0,null)}else console.error("THREE.Renderer: Unsupported background configuration.",t);if(!0===a.autoClear||!0===l){const e=r.clearColorValue;e.r=_clearColor.r,e.g=_clearColor.g,e.b=_clearColor.b,e.a=_clearColor.a,!0!==a.backend.isWebGLBackend&&!0!==a.alpha||(e.r*=e.a,e.g*=e.a,e.b*=e.a),r.depthClearValue=a._clearDepth,r.stencilClearValue=a._clearStencil,r.clearColor=!0===a.autoClearColor,r.clearDepth=!0===a.autoClearDepth,r.clearStencil=!0===a.autoClearStencil}else r.clearColor=!1,r.clearDepth=!1,r.clearStencil=!1}}export default Background;
//# sourceMappingURL=/sm/c688747e719eede5268a0266fe1d8294695817744e66fceffb43a322f07686e0.map