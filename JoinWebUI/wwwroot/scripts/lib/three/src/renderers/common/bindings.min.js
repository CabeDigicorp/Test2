/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/three@0.170.0/src/renderers/common/Bindings.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import DataMap from"./DataMap.js";import{AttributeType}from"./Constants.js";class Bindings extends DataMap{constructor(t,e,i,s,n,r){super(),this.backend=t,this.textures=i,this.pipelines=n,this.attributes=s,this.nodes=e,this.info=r,this.pipelines.bindings=this}getForRender(t){const e=t.getBindings();for(const t of e){const i=this.get(t);void 0===i.bindGroup&&(this._init(t),this.backend.createBindings(t,e),i.bindGroup=t)}return e}getForCompute(t){const e=this.nodes.getForCompute(t).bindings;for(const t of e){const i=this.get(t);void 0===i.bindGroup&&(this._init(t),this.backend.createBindings(t,e),i.bindGroup=t)}return e}updateForCompute(t){this._updateBindings(this.getForCompute(t))}updateForRender(t){this._updateBindings(this.getForRender(t))}_updateBindings(t){for(const e of t)this._update(e,t)}_init(t){for(const e of t.bindings)if(e.isSampledTexture)this.textures.updateTexture(e.texture);else if(e.isStorageBuffer){const t=e.attribute,i=t.isIndirectStorageBufferAttribute?AttributeType.INDIRECT:AttributeType.STORAGE;this.attributes.update(t,i)}}_update(t,e){const{backend:i}=this;let s=!1;for(const e of t.bindings){if(e.isNodeUniformsGroup){if(!this.nodes.updateGroup(e))continue}if(e.isUniformBuffer){e.update()&&i.updateBinding(e)}else if(e.isSampler)e.update();else if(e.isSampledTexture){e.needsBindingsUpdate(this.textures.get(e.texture).generation)&&(s=!0);const t=e.update(),n=e.texture;t&&this.textures.updateTexture(n);const r=i.get(n);if(!0===i.isWebGPUBackend&&void 0===r.texture&&void 0===r.externalTexture&&(console.error("Bindings._update: binding should be available:",e,t,n,e.textureNode.value,s),this.textures.updateTexture(n),s=!0),!0===n.isStorageTexture){const t=this.get(n);!0===e.store?t.needsMipmap=!0:this.textures.needsMipmaps(n)&&!0===t.needsMipmap&&(this.backend.generateMipmaps(n),t.needsMipmap=!1)}}}!0===s&&this.backend.updateBindings(t,e)}}export default Bindings;
//# sourceMappingURL=/sm/c605a462599276c106fb613341f40a8a2c19fc5094d88e9172eaef90ba4ae01b.map